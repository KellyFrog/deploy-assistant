# Deploy-Assistant

借助 LLM 和终端交互完成项目自动部署/安装。

大概的工作流程和要实现的东西：

- 终端部分：实现一个模拟终端，终端类模拟/和一个 powershell 交互，支持输入一条命令，返回它的输出（stdout 和 stderr）
- LLM 调用集成模块：实现一个 LLM 交互封装类，封装和 API/本地模型 交互的过程。
- Prompt 工程：
  - 设计整个和 LLM 交互流程中的 Prompt，应当先确定交互流程。
- Agent 模块：
  - 允许部分和本地文件交互（这个如果只实现一件部署可能不是特别需要）。
  - 可能可以实现计划功能，让 LLM 先做整体计划然后分布进行（这样可扩展性强一点，可能可以迁移到其他功能）。
- 记忆模块：给 LLM 提示告诉他现在在干什么/已经干了什么。
- 安全模块：实现一个函数，区别安全和危险指令（用户可以选择默认执行安全指令，但危险指令必须手动确认）。
- 应用后端：实现一个类，表示当前整个运行流程的对象，供前端调用。
- 应用前端：可以先写 CLI，剩下的之后再说。

现在已经实现/已经认领的任务：

- 终端部分：已经初步写完，但是比较粗糙，感觉当一个玩具已经够了
- 剩下的都没写。

现在比较紧急的任务：

- 确定和 LLM 交互的整个流程以及通过外部工具实现的功能，它应当大体包括：
  - 环境检测：首先让 LLM 看看需要装什么应用（如 cmake、cargo、npm 等命令行工具是否安装），这可能直接集成一些效率会高一点。
  - 命令分解：让 LLM 确定每一个步骤和一条命令。
  - 问题检测：运行完命令后，将内容返回给 LLM 检查运行是否符合预期。
  - 修复问题：在这一个步骤当中解决这一个步骤的问题，同样返回当前的命令。
  - 问题决策：有一些问题需要让用户决策，如使用 MSVC 还是 MinGW 编译、使用 Qt5 还是 Qt6、用哪个 conda 环境 / python 版本等，这些问题不适合让 AI 决定，应当有交互的过程。

已经规划好的任务：
- 实现一个包装好的 LLM 类，包括 Prompt、附加文件、流式返回等功能

推荐试用一下 vscode 的 cline 插件，看别人的 agent 写成了啥样，看看那些地方会遇到问题（主要是遇到依赖问题根本不检测/反复重装环境、交互速度慢），针对部署这一专门需求设计 Prompt。

---

流程：

- 实现模拟终端

- 实现命令行辅助功能（在用户遇到问题的时候生成建议）

  期望结果：在使用该终端的时候默认进行记忆，然后实现一个【获取建议】的功能。这个功能最好的结果是直接生成命令供用户进行执行（并附上简要解释），在有必要（或者用户想）的时候需要用户提供额外的一些信息。

  - LLM 交互模块
    - 简单实现一个交互的接口
  - Agent 模块
    - 一些必要的和本地文件的一些交互（比如读取目录下列表以及环境信息等）
  - 记忆模块
    - 短期记忆：近期若干个命令&返回值的直接记录
    - 中短期记忆：将命令行的历史记录进行总结，然后存储
    - 长期记忆：用户设备环境和个人画像
  - 安全模块
    - 区分 LLM 所提出的建议的安全程度
    - 对提出的方案进行自我质疑和批判

- 实现对github特化的一键部署

  期望结果：实现【Github 项目部署】功能，利用 Github project 的 readme 文件，生成下载步骤的一个计划，然后利用前面的功能进行自动部署。

  - 方法：先根据 readme 判断如何下载（比如直接 clone，还是有release可以直接用），然后下载之后，形成一个计划，分解成若干个步骤。
  - 对于每一个步骤，用一定的prompt去调用【获取建议】，然后进行操作

- 实现一个 GUI

---

重要函数意义：

- LLM
  - LLM_handler.LLMHandler
    - print_response_stream：用流输出的方式输出 response，并返回该 response.
    - gen_response：给定 context, memory, user\_comment, user_answer，向 llm 发送 prompt，并打印并返回回答. 回答有两种情况，一种是需要用户进一步回答问题，另一种是直接给出command.
    - response_parser：对 response 进行解析. 最终结果应该是一个 `("command",[(command, explanation, warning/comment)])`，或者一个 `("ask",quesion)`.
- agent
  - agent.Agent
    - gen_suggestion：传入用户的额外评论，以及面对之前可能问的问题的一些回答的 list. 可能会向用户问问题或者执行命令. 如果用户输入 "Q" 那么退出这次的 suggestion 并返回 "none". 否则返回 command.
    - record_command(command, result, error="")：CLI 每执行一条命令就调用一次 record_command，agent 会将其发送至 memory management.

请注意：换用新的 terminal_simulator.py 之后原有的处理可能失效，请确认这一点，或者你可以现根据上两个版本开发其他的部分。